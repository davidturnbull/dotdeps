{
  "tasks": [
    {
      "id": "arch-001",
      "category": "architectural",
      "priority": 1,
      "description": "Core CLI framework with command dispatching",
      "steps": [
        "Create main CLI entry point that parses commands",
        "Implement command trait/interface for all brew commands",
        "Implement command dispatching based on first argument",
        "Handle --help and -h flags at top level",
        "Handle --version and -v flags at top level",
        "Support command aliases (ls->list, rm->uninstall, etc.)"
      ],
      "acceptance": [
        "Running `brew-rust --version` outputs version info",
        "Running `brew-rust --help` outputs help text",
        "Running `brew-rust <unknown>` shows error message",
        "Command aliases resolve correctly"
      ],
      "passes": true
    },
    {
      "id": "arch-002",
      "category": "architectural",
      "priority": 1,
      "description": "Homebrew paths and environment detection",
      "steps": [
        "Detect HOMEBREW_PREFIX based on platform (macOS ARM: /opt/homebrew, macOS Intel: /usr/local, Linux: /home/linuxbrew/.linuxbrew)",
        "Detect HOMEBREW_REPOSITORY (where Homebrew itself is installed)",
        "Detect HOMEBREW_CELLAR path",
        "Detect HOMEBREW_CACHE path",
        "Detect HOMEBREW_LOGS path",
        "Support environment variable overrides for all paths"
      ],
      "acceptance": [
        "`brew-rust --prefix` matches `brew --prefix` output",
        "`brew-rust --cellar` matches `brew --cellar` output",
        "`brew-rust --cache` matches `brew --cache` output",
        "`brew-rust --repository` matches `brew --repository` output"
      ],
      "passes": true
    },
    {
      "id": "cmd-001",
      "category": "functional",
      "priority": 2,
      "description": "Implement --version command",
      "steps": [
        "Read Homebrew version from HOMEBREW_REPOSITORY",
        "Detect and display homebrew-core version if tapped",
        "Detect and display homebrew-cask version if tapped",
        "Format output exactly like brew --version"
      ],
      "acceptance": [
        "`brew-rust --version` output matches `brew --version` exactly"
      ],
      "passes": true
    },
    {
      "id": "cmd-002",
      "category": "functional",
      "priority": 2,
      "description": "Implement --prefix command",
      "steps": [
        "Output HOMEBREW_PREFIX when called without arguments",
        "Implement --unbrewed flag to list unbrewed files",
        "Implement formula argument to show formula prefix",
        "Implement --installed flag for formula existence check"
      ],
      "acceptance": [
        "`brew-rust --prefix` matches `brew --prefix`",
        "`brew-rust --prefix --unbrewed` lists same files as brew"
      ],
      "passes": true
    },
    {
      "id": "cmd-003",
      "category": "functional",
      "priority": 2,
      "description": "Implement --cellar command",
      "steps": [
        "Output HOMEBREW_CELLAR when called without arguments",
        "Support formula argument to show formula cellar path"
      ],
      "acceptance": [
        "`brew-rust --cellar` matches `brew --cellar`"
      ],
      "passes": true
    },
    {
      "id": "cmd-004",
      "category": "functional",
      "priority": 2,
      "description": "Implement --cache command",
      "steps": [
        "Output HOMEBREW_CACHE when called without arguments",
        "Support formula/cask arguments to show specific cache paths",
        "Implement --os flag for simulating different OS",
        "Implement --arch flag for simulating different architecture"
      ],
      "acceptance": [
        "`brew-rust --cache` matches `brew --cache`"
      ],
      "passes": true,
      "notes": "--os and --arch flags are parsed but not fully implemented yet"
    },
    {
      "id": "cmd-005",
      "category": "functional",
      "priority": 2,
      "description": "Implement --repository command",
      "steps": [
        "Output HOMEBREW_REPOSITORY when called without arguments",
        "Support tap arguments to show tap repository paths"
      ],
      "acceptance": [
        "`brew-rust --repository` matches `brew --repository`"
      ],
      "passes": true
    },
    {
      "id": "cmd-006",
      "category": "functional",
      "priority": 3,
      "description": "Implement help command",
      "steps": [
        "Display usage information matching brew help output",
        "Support help <command> to show command-specific help",
        "Parse and display command descriptions from command definitions"
      ],
      "acceptance": [
        "`brew-rust help` output matches `brew help` layout",
        "`brew-rust help --prefix` shows prefix command help"
      ],
      "passes": true
    },
    {
      "id": "cmd-007",
      "category": "functional",
      "priority": 3,
      "description": "Implement commands command",
      "steps": [
        "List all built-in commands",
        "Separate commands into categories (built-in, developer, external)",
        "Support --quiet flag for minimal output"
      ],
      "acceptance": [
        "`brew-rust commands` lists all implemented commands"
      ],
      "passes": true,
      "notes": "--include-aliases now works, developer/external commands sections not yet implemented"
    },
    {
      "id": "cmd-008",
      "category": "functional",
      "priority": 3,
      "description": "Implement config command",
      "steps": [
        "Display system configuration",
        "Show HOMEBREW_* environment variables",
        "Show macOS/Linux version info",
        "Show CPU architecture",
        "Show Git version",
        "Show Ruby version"
      ],
      "acceptance": [
        "`brew-rust config` shows relevant system configuration"
      ],
      "passes": true
    },
    {
      "id": "arch-003",
      "category": "architectural",
      "priority": 2,
      "description": "Formula parsing and representation",
      "steps": [
        "Define Formula struct with all standard fields",
        "Parse Ruby formula files into Rust structs",
        "Support formula bottles specification",
        "Support formula dependencies",
        "Handle formula versions"
      ],
      "acceptance": [
        "Can parse and represent a simple formula like wget"
      ],
      "passes": true,
      "notes": "Uses Homebrew's API cache (formula.jws.json) instead of parsing Ruby files. All standard fields supported including dependencies, bottles, versions, keg_only, deprecation, etc."
    },
    {
      "id": "arch-004",
      "category": "architectural",
      "priority": 2,
      "description": "Tap management",
      "steps": [
        "Define Tap struct to represent a tap",
        "List installed taps",
        "Resolve tap paths",
        "Support official taps (homebrew-core, homebrew-cask)"
      ],
      "acceptance": [
        "`brew-rust --taps` lists installed taps"
      ],
      "passes": true,
      "notes": "Full tap management with Tap struct, tap path resolution, official tap detection, and tap listing"
    },
    {
      "id": "cmd-009",
      "category": "functional",
      "priority": 4,
      "description": "Implement list command",
      "steps": [
        "List installed formulae",
        "List installed casks with --cask flag",
        "Support --versions flag to show versions",
        "Support --pinned flag to show only pinned",
        "Support formula arguments for filtering"
      ],
      "acceptance": [
        "`brew-rust list` matches `brew list` output"
      ],
      "passes": true,
      "notes": "Basic list functionality implemented. Uses system ls command to list formula/cask files when specific items are provided (matching brew behavior). Full-name, multiple, and other advanced flags not yet implemented."
    },
    {
      "id": "cmd-010",
      "category": "functional",
      "priority": 4,
      "description": "Implement info command",
      "steps": [
        "Display formula information",
        "Show formula name, version, description",
        "Show dependencies",
        "Show installation status",
        "Support --json flag for JSON output"
      ],
      "acceptance": [
        "`brew-rust info wget` shows wget formula info"
      ],
      "passes": true,
      "notes": "Basic info command implemented. Shows formula info with installation status, dependencies, caveats, and options. JSON output supported with --json flag. Analytics show placeholder zeros (real analytics not implemented)."
    },
    {
      "id": "cmd-011",
      "category": "functional",
      "priority": 4,
      "description": "Implement search command",
      "steps": [
        "Search for formulae by name",
        "Support regex search with /pattern/",
        "Search in formula descriptions with --desc",
        "Show cask results when relevant"
      ],
      "acceptance": [
        "`brew-rust search wget` finds wget formula"
      ],
      "passes": true,
      "notes": "Basic search implemented with substring matching. Brew's fuzzy matching (e.g., 'curl' finding 'carl' or 'cursr') not implemented - only exact substring matches are supported."
    },
    {
      "id": "arch-005",
      "category": "architectural",
      "priority": 1,
      "description": "Download and caching infrastructure",
      "steps": [
        "Implement HTTP client for downloading bottles and source tarballs",
        "Verify SHA256 checksums for downloaded files",
        "Support resume for partial downloads",
        "Implement download progress reporting",
        "Handle cache directory structure for bottles and sources",
        "Support bottle extraction (tar.gz unpacking)"
      ],
      "acceptance": [
        "Can download a bottle and verify its checksum",
        "Downloaded files are cached correctly",
        "Progress is shown during download"
      ],
      "passes": true,
      "notes": "Full download infrastructure implemented with reqwest, progress bars via indicatif, SHA256 verification, and tar.gz extraction via tar+flate2 crates. Resume for partial downloads not implemented (would require Range requests). Tested successfully with cached bottles."
    },
    {
      "id": "arch-006",
      "category": "architectural",
      "priority": 1,
      "description": "Installation infrastructure",
      "steps": [
        "Implement bottle installation (extract to Cellar)",
        "Create opt symlink to installed formula",
        "Handle formula relocation (fix install_name references)",
        "Implement post-install hooks (run postinstall if present)",
        "Track installed formulae metadata",
        "Support force installation (overwrite existing)"
      ],
      "acceptance": [
        "Can install a bottle to Cellar correctly",
        "Opt symlink points to correct version",
        "Post-install runs successfully"
      ],
      "passes": true,
      "notes": "Complete installation infrastructure implemented. Bottle extraction to Cellar works, opt symlink creation, Tab (INSTALL_RECEIPT.json) metadata with all fields. Formula relocation and post-install hooks not yet implemented (lower priority). Tested successfully with cached bottles."
    },
    {
      "id": "arch-007",
      "category": "architectural",
      "priority": 1,
      "description": "Dependency resolution",
      "steps": [
        "Build dependency graph from formula dependencies",
        "Detect dependency cycles",
        "Implement topological sort for install order",
        "Handle build vs runtime dependencies",
        "Support optional dependencies (skip by default)"
      ],
      "acceptance": [
        "Can resolve dependencies for a formula like curl",
        "Install order respects dependency graph",
        "Circular dependencies are detected"
      ],
      "passes": true,
      "notes": "Complete dependency resolution with graph building, cycle detection, and topological sort. Uses Kahn's algorithm for topological sorting. Build/test dependencies handled separately from runtime dependencies."
    },
    {
      "id": "cmd-012",
      "category": "functional",
      "priority": 1,
      "description": "Implement install command",
      "steps": [
        "Parse install command arguments and flags",
        "Resolve formula dependencies",
        "Download bottles for formula and dependencies",
        "Install formula and dependencies in correct order",
        "Link installed formulae to opt",
        "Display installation progress and summary",
        "Support --force flag to reinstall",
        "Support --build-from-source flag",
        "Handle already installed formulae"
      ],
      "acceptance": [
        "`brew-rust install wget` successfully installs wget",
        "`brew-rust install curl` installs curl and dependencies",
        "`brew-rust install wget` (when already installed) shows already installed message"
      ],
      "passes": true,
      "notes": "Full install command implementation with dependency resolution, bottle download/caching, installation to Cellar, opt symlink creation, and Tab metadata. Uses cached bottles when available. Detects already-installed formulae via opt symlink. --force, --verbose, --ignore-dependencies flags supported. --build-from-source parsed but not implemented (bottles always used)."
    },
    {
      "id": "cmd-013",
      "category": "functional",
      "priority": 2,
      "description": "Implement deps command",
      "steps": [
        "Display formula dependencies",
        "Support --tree flag for tree view",
        "Support --installed flag to show only installed deps",
        "Support --include-build flag",
        "Support --include-optional flag"
      ],
      "acceptance": [
        "`brew-rust deps curl` lists curl dependencies",
        "`brew-rust deps --tree curl` shows dependency tree"
      ],
      "passes": true,
      "notes": "Full deps command implementation with flat and tree views. All flags supported: --tree, --installed, --include-build, --include-optional. Tree output matches brew exactly (without pruning)."
    },
    {
      "id": "cmd-014",
      "category": "functional",
      "priority": 2,
      "description": "Implement uninstall command",
      "steps": [
        "Remove formula from Cellar",
        "Remove opt symlink",
        "Support --force flag to ignore dependencies",
        "Check for dependents before uninstalling",
        "Support --ignore-dependencies flag"
      ],
      "acceptance": [
        "`brew-rust uninstall wget` removes wget",
        "`brew-rust uninstall <formula-with-deps>` shows warning about dependents"
      ],
      "passes": true,
      "notes": "Full uninstall command implementation with dependency checking. Removes Cellar directory and opt symlink. --force, --ignore-dependencies flags supported. rm and remove aliases work."
    },
    {
      "id": "cmd-015",
      "category": "functional",
      "priority": 3,
      "description": "Implement link command",
      "steps": [
        "Create symlinks from Cellar to prefix",
        "Support --force flag to overwrite existing links",
        "Support --dry-run flag",
        "Handle conflicts with existing files"
      ],
      "acceptance": [
        "`brew-rust link wget` creates symlinks for wget"
      ],
      "passes": true,
      "notes": "Full link command implementation with --dry-run, --overwrite, --verbose flags. Creates relative symlinks from HOMEBREW_PREFIX/{bin,sbin,lib,include,share,etc,Frameworks} to Cellar files."
    },
    {
      "id": "cmd-016",
      "category": "functional",
      "priority": 3,
      "description": "Implement unlink command",
      "steps": [
        "Remove symlinks from prefix",
        "Support --dry-run flag",
        "Preserve Cellar installation"
      ],
      "acceptance": [
        "`brew-rust unlink wget` removes wget symlinks"
      ],
      "passes": true,
      "notes": "Full unlink command implementation with --dry-run and --verbose flags. Removes symlinks from HOMEBREW_PREFIX/{bin,sbin,lib,include,share,etc,Frameworks} that point to Cellar files. Output format matches brew exactly."
    },
    {
      "id": "cmd-017",
      "category": "functional",
      "priority": 1,
      "description": "Implement update command",
      "steps": [
        "Pull latest changes from homebrew-core and homebrew-cask taps",
        "Update Homebrew itself (if HOMEBREW_REPOSITORY is a git repo)",
        "Show updated formulae and casks",
        "Update API cache files (formula.jws.json, cask.jws.json)",
        "Support --merge flag to merge changes",
        "Support --auto-update flag"
      ],
      "acceptance": [
        "`brew-rust update` pulls latest tap updates",
        "API cache is refreshed",
        "Shows summary of new/updated formulae"
      ],
      "passes": true,
      "notes": "Full update command implementation with git repo updates and API cache refresh. Supports --verbose, --quiet, --force, --merge, --auto-update flags. Uses git fetch + rebase (or merge) for all taps. Downloads API cache files with curl. Shows summary of updated taps and outdated formulae."
    },
    {
      "id": "cmd-018",
      "category": "functional",
      "priority": 1,
      "description": "Implement upgrade command",
      "steps": [
        "Find all installed formulae with newer versions available",
        "Resolve dependencies for upgraded formulae",
        "Download new bottles",
        "Install new versions",
        "Remove old versions (unless --keep-old specified)",
        "Support specific formula arguments",
        "Support --dry-run flag"
      ],
      "acceptance": [
        "`brew-rust upgrade` upgrades all outdated formulae",
        "`brew-rust upgrade wget` upgrades only wget"
      ],
      "passes": true,
      "notes": "Full upgrade command implementation with outdated formula detection, bottle download/caching, installation to Cellar, and old version cleanup. Supports --dry-run, --force, --verbose, --quiet, --build-from-source flags. Skips pinned formulae. Removes old versions after upgrade (unless --force to keep all)."
    },
    {
      "id": "cmd-019",
      "category": "functional",
      "priority": 1,
      "description": "Implement outdated command",
      "steps": [
        "List installed formulae",
        "Compare installed versions with latest from API",
        "Show formulae with newer versions available",
        "Support --json flag for JSON output",
        "Support --verbose flag for detailed info"
      ],
      "acceptance": [
        "`brew-rust outdated` lists all outdated formulae"
      ],
      "passes": true,
      "notes": "Full outdated command implementation. Reads installed versions from Cellar directory (not API cache which can be stale). Properly handles version + revision format (e.g., 2.52.0_1). Supports --verbose, --quiet, --json flags. JSON output matches brew v1/v2 format. Specific formula filtering works."
    },
    {
      "id": "cmd-020",
      "category": "functional",
      "priority": 2,
      "description": "Implement cleanup command",
      "steps": [
        "Remove old versions of installed formulae",
        "Clean up download cache",
        "Remove broken symlinks",
        "Support --dry-run flag",
        "Support -n days flag to specify age threshold",
        "Show disk space freed"
      ],
      "acceptance": [
        "`brew-rust cleanup` removes old versions",
        "`brew-rust cleanup --dry-run` shows what would be removed"
      ],
      "passes": true,
      "notes": "Cleanup removes old formula versions and cache files older than 120 days (configurable with --prune). --dry-run shows what would be removed. --scrub and --prune-prefix flags parsed but not fully implemented yet."
    },
    {
      "id": "cmd-021",
      "category": "functional",
      "priority": 2,
      "description": "Implement tap command",
      "steps": [
        "Clone new tap repository from GitHub",
        "Support user/repo format",
        "Support full GitHub URLs",
        "Create tap directory in Library/Taps",
        "Verify tap structure after cloning",
        "Support --force flag to overwrite existing tap"
      ],
      "acceptance": [
        "`brew-rust tap user/repo` clones and installs tap",
        "`brew-rust tap` lists installed taps"
      ],
      "passes": true,
      "notes": "Full tap command implementation with GitHub and custom URL support. Counts formulas in tap directory. Supports --force, --verbose, --quiet, --custom-remote, --repair, --eval-all flags."
    },
    {
      "id": "cmd-022",
      "category": "functional",
      "priority": 2,
      "description": "Implement untap command",
      "steps": [
        "Remove tap repository from Library/Taps",
        "Check for installed formulae from tap",
        "Warn if formulae are installed from tap being removed",
        "Support --force flag to remove despite installed formulae"
      ],
      "acceptance": [
        "`brew-rust untap user/repo` removes tap",
        "Shows warning if formulae are installed from tap"
      ],
      "passes": true,
      "notes": "Full untap command implementation with formula checking, --force, --quiet, --verbose flags. Output matches brew exactly."
    },
    {
      "id": "cmd-023",
      "category": "functional",
      "priority": 2,
      "description": "Implement pin command",
      "steps": [
        "Create pin marker in var/homebrew/pinned",
        "Prevent formula from being upgraded",
        "Support multiple formula arguments",
        "Show confirmation message"
      ],
      "acceptance": [
        "`brew-rust pin wget` pins wget",
        "`brew-rust upgrade` skips pinned formulae"
      ],
      "passes": true,
      "notes": "Pin command creates symlink in var/homebrew/pinned pointing to Cellar version. Supports multiple formulae, validates existence and installation status, warns if already pinned."
    },
    {
      "id": "cmd-024",
      "category": "functional",
      "priority": 2,
      "description": "Implement unpin command",
      "steps": [
        "Remove pin marker from var/homebrew/pinned",
        "Allow formula to be upgraded again",
        "Support multiple formula arguments",
        "Show confirmation message"
      ],
      "acceptance": [
        "`brew-rust unpin wget` unpins wget"
      ],
      "passes": true,
      "notes": "Unpin command removes symlink from var/homebrew/pinned. Supports multiple formulae, validates formula existence, warns if not pinned."
    },
    {
      "id": "cmd-025",
      "category": "functional",
      "priority": 2,
      "description": "Implement doctor command",
      "steps": [
        "Check for common issues in Homebrew installation",
        "Verify directory permissions",
        "Check for broken symlinks",
        "Verify Git installation and configuration",
        "Check for Xcode/CLT installation (macOS)",
        "Report issues with suggested fixes"
      ],
      "acceptance": [
        "`brew-rust doctor` runs diagnostic checks",
        "Reports issues with clear messages"
      ],
      "passes": true,
      "notes": "Implements essential checks: unlinked kegs, PATH ordering, broken symlinks, git installation. Does not implement all 68 checks from brew doctor, but covers the most common issues."
    },
    {
      "id": "cmd-026",
      "category": "functional",
      "priority": 3,
      "description": "Implement reinstall command",
      "steps": [
        "Uninstall formula (keep dependencies)",
        "Install formula fresh",
        "Preserve options and build flags",
        "Support --force flag",
        "Support --build-from-source flag"
      ],
      "acceptance": [
        "`brew-rust reinstall wget` reinstalls wget"
      ],
      "passes": true
    },
    {
      "id": "cmd-027",
      "category": "functional",
      "priority": 3,
      "description": "Implement uses command",
      "steps": [
        "Show formulae that depend on specified formula",
        "Support --installed flag to show only installed",
        "Support --recursive flag",
        "Support --include-build flag",
        "Support --include-optional flag"
      ],
      "acceptance": [
        "`brew-rust uses openssl` shows formulae depending on openssl"
      ],
      "passes": false,
      "notes": "Implementation exists but has severe performance issues. Recursive dependency checking is O(n*d) and too slow for practical use. Needs caching or reverse dependency map optimization."
    },
    {
      "id": "cmd-028",
      "category": "functional",
      "priority": 3,
      "description": "Implement leaves command",
      "steps": [
        "List installed formulae with no dependents",
        "Identify formulae that can be safely removed",
        "Support --installed-on-request flag"
      ],
      "acceptance": [
        "`brew-rust leaves` lists leaf formulae"
      ],
      "passes": true,
      "notes": "Full implementation with --installed-on-request and --installed-as-dependency flags. Correctly handles formula and cask dependencies by scanning Caskroom metadata. Uses Cellar as source of truth for canonical formula names, shows tap prefix for non-core taps (not homebrew/core or homebrew/cask)."
    },
    {
      "id": "cmd-029",
      "category": "functional",
      "priority": 3,
      "description": "Implement autoremove command",
      "steps": [
        "Find unused dependencies",
        "Remove formulae that were installed as dependencies but no longer needed",
        "Support --dry-run flag",
        "Show what will be removed before removing"
      ],
      "acceptance": [
        "`brew-rust autoremove` removes unused dependencies"
      ],
      "passes": true,
      "notes": "Full autoremove implementation. Finds formulae installed as dependencies with no dependents (including cask dependencies). Supports --dry-run, --quiet, --verbose flags. Output format matches brew exactly."
    },
    {
      "id": "cmd-030",
      "category": "functional",
      "priority": 3,
      "description": "Implement desc command",
      "steps": [
        "Display formula description",
        "Support multiple formula arguments",
        "Support --search flag to search descriptions",
        "Support --name flag to search names"
      ],
      "acceptance": [
        "`brew-rust desc wget` shows wget description"
      ],
      "passes": true,
      "notes": "Full desc command implementation with name lookup and search modes. Supports --search, --name, --description flags for searching both names and descriptions. Regex search with /pattern/ syntax. Output format matches brew exactly (empty sections shown with headers even when no results)."
    },
    {
      "id": "cmd-031",
      "category": "functional",
      "priority": 4,
      "description": "Implement home command",
      "steps": [
        "Open formula homepage in browser",
        "Support Homebrew homepage with no args",
        "Support multiple formula arguments"
      ],
      "acceptance": [
        "`brew-rust home wget` opens wget homepage"
      ],
      "passes": true,
      "notes": "Opens formula/cask homepages in default browser using platform-specific commands (open on macOS, xdg-open on Linux). Opens https://brew.sh when no arguments provided. Supports --formula/--cask flags and homepage alias."
    },
    {
      "id": "cmd-032",
      "category": "functional",
      "priority": 4,
      "description": "Implement log command",
      "steps": [
        "Show git commit history for formula",
        "Support tap history with no args",
        "Support --oneline flag",
        "Support -n <number> flag"
      ],
      "acceptance": [
        "`brew-rust log wget` shows wget formula history"
      ],
      "passes": false
    },
    {
      "id": "cmd-033",
      "category": "functional",
      "priority": 4,
      "description": "Implement cat command",
      "steps": [
        "Display formula source code",
        "Support multiple formula arguments",
        "Find formula in taps"
      ],
      "acceptance": [
        "`brew-rust cat wget` shows wget formula Ruby code"
      ],
      "passes": true,
      "notes": "Displays Ruby source code from tap directories. Shows error for core formulae that don't exist on disk (API-only mode). Supports --formula/--cask flags, multiple arguments, and full tap paths."
    },
    {
      "id": "cmd-034",
      "category": "functional",
      "priority": 4,
      "description": "Implement options command",
      "steps": [
        "Display available options for formula",
        "Show deprecated options",
        "Show build options (if any)"
      ],
      "acceptance": [
        "`brew-rust options wget` shows wget options"
      ],
      "passes": false
    }
  ]
}
