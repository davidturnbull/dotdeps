# Ralph Progress

<!-- This file tracks progress across Ralph iterations -->
<!-- Each iteration appends its completed work here -->

## Iteration 1 - 2026-01-23

### Completed Tasks
- **arch-001**: Core CLI framework with command dispatching
- **arch-002**: Homebrew paths and environment detection

### Key Decisions
- Used Rust 2024 edition
- Created a `Command` trait for all brew commands with `name()`, `description()`, and `run()` methods
- Implemented platform-specific path detection using `#[cfg]` attributes
- Command aliases are resolved centrally in `resolve_alias()` matching Homebrew's `HOMEBREW_INTERNAL_COMMAND_ALIASES`
- Used `git describe --tags` to get Homebrew version, matching actual Homebrew behavior

### Files Changed
- `Cargo.toml` - Added binary target `brew-rust`
- `src/main.rs` - CLI entry point with command dispatching
- `src/paths.rs` - Path detection for HOMEBREW_PREFIX, CELLAR, CACHE, etc.
- `src/commands/mod.rs` - Command trait definition
- `src/commands/version.rs` - --version command
- `src/commands/prefix.rs` - --prefix command
- `src/commands/cellar.rs` - --cellar command
- `src/commands/cache.rs` - --cache command
- `src/commands/repository.rs` - --repository command
- `src/commands/caskroom.rs` - --caskroom command
- `src/commands/taps.rs` - --taps command
- `src/commands/help.rs` - help command
- `src/commands/commands.rs` - commands command

### Verification
All basic path commands tested and match `brew` output:
- `brew-rust --version` ✓
- `brew-rust --prefix` ✓
- `brew-rust --cellar` ✓
- `brew-rust --cache` ✓
- `brew-rust --repository` ✓
- `brew-rust --caskroom` ✓
- `brew-rust --taps` ✓
- `brew-rust help` ✓
- `brew-rust commands` ✓
- Alias resolution (`-v` -> `--version`) ✓
- Unknown command error handling ✓

### Notes
- `--cache` with formula/cask arguments not yet implemented
- Help for specific commands not yet implemented
- Developer commands section in `commands` not yet implemented

## Iteration 2 - 2026-01-23

### Completed Tasks
- **cmd-001**: Verified --version command matches brew output (already implemented)
- **cmd-002**: Implement --prefix command with full feature support

### Key Decisions
- Used formula_names.txt cache file from Homebrew API to validate formula existence
- Fallback to checking opt symlink existence when cache unavailable
- --unbrewed implementation dynamically scans prefix subdirectories, excluding Cellar/Library/Caskroom/etc
- Exact match to Homebrew's exclude patterns for --unbrewed

### Files Changed
- `src/commands/prefix.rs` - Full --prefix implementation with formula args, --installed, --unbrewed

### Verification
All --prefix behaviors tested and match `brew` output:
- `brew-rust --prefix` ✓
- `brew-rust --prefix <formula>` outputs opt prefix ✓
- `brew-rust --prefix --installed <formula>` ✓
- `brew-rust --prefix --installed <missing>` returns error ✓
- `brew-rust --prefix --unbrewed` lists same files ✓
- `brew-rust --prefix <nonexistent>` shows formula not found ✓
- Flag conflicts (--unbrewed + --installed) handled ✓

### Notes
- Formula existence check uses API cache (~/Library/Caches/Homebrew/api/formula_names.txt)
- Next priority: --cellar with formula arguments

## Iteration 3 - 2026-01-23

### Completed Tasks
- **cmd-003**: Implement --cellar command with formula arguments

### Key Decisions
- Created `src/formula.rs` module with shared formula utilities (`exists`, `normalize_name`)
- Refactored `prefix.rs` to use shared formula module
- Formula name normalization handles tap paths (e.g., `homebrew/core/wget` → `wget`)
- Error message format matches brew exactly: `No available formula with the name "X".`

### Files Changed
- `src/formula.rs` - New module with formula existence and name normalization utilities
- `src/main.rs` - Added formula module import
- `src/commands/cellar.rs` - Full --cellar implementation with formula arguments
- `src/commands/prefix.rs` - Refactored to use shared formula module

### Verification
All --cellar behaviors tested and match `brew` output:
- `brew-rust --cellar` ✓
- `brew-rust --cellar <formula>` ✓
- `brew-rust --cellar <formula1> <formula2> <formula3>` ✓
- `brew-rust --cellar homebrew/core/<formula>` ✓
- `brew-rust --cellar <nonexistent>` shows error ✓

### Notes
- Next priority: --cache with formula/cask arguments (cmd-004)

